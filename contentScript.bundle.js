(()=>{console.log("Content script works!"),console.log("Must reload extension for modifications to take effect.");let e=null;chrome.runtime.onMessage.addListener(((o,t,s)=>{console.log("Message received in content script:",o),"test"===o.action&&s({message:"Test message received in content script"}),"startStream"===o.action&&(console.log("Requesting permissions for video and audio..."),navigator.permissions.query({name:"microphone"}).then((e=>{console.log(e.state)})).catch((e=>{console.log("Got error :",e)})),navigator.permissions.query({name:"camera"}).then((e=>{console.log(e.state)})).catch((e=>{console.log("Got error :",e)})),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){console.log("Permissions granted, here is the stream: ",e),localStorage.setItem("mediaStream",JSON.stringify(e)),chrome.runtime.sendMessage({action:"mediaStream",stream:e})})).catch((function(e){console.error("Error accessing media devices: ",e)})),s({message:"Media capture started"})),"stopStream"===o.action&&(e?(e.getTracks().forEach((function(e){e.stop()})),console.log("Media capture stopped."),e=null,chrome.runtime.sendMessage({type:"mediaStreamStopped"})):console.log("No media stream to stop."),s({message:"Media capture stopped"}))}))})();